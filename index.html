<html>
  <head>
    <script class="text/javascript">
      window.guides = {
        'Any%': 'WG_any_v3',
        'All Lasers': 'WG_all_lasers_final',
        '100%': 'WG_100_final2',
        '100% (advanced)': 'WG_100_advanced_final2',
        'Low% (117, obsolete)': 'WG_low_final',
        'All Discarded Panels': 'WG_all_discards',
        'All Discarded Panels Low%': 'WG_all_discards_low',
      }

      function getImage(guideName, index) {
        var url = 'https://raw.githubusercontent.com/jbzdarkid/WitnessGuide/main/'
        return url + index.toString().padStart(5, '0') + '.png'
      }

      window.onload = function() {
        var guideChooser = document.getElementById('guideChooser')
        var nextPicture = document.getElementById('nextPicture')
        var downloadSplits = document.getElementById('downloadSplits')

        var preloadPicture = document.createElement('IMG')
        document.body.appendChild(preloadPicture)
        preloadPicture.style.display = 'none'

        for (var guide of Object.keys(window.guides)) {
          var option = document.createElement('option')
          option.innerText = guide
          guideChooser.appendChild(option)
        }
        // Defaults on page load
        guideChooser.value = 'Any%'
        nextPicture.setAttribute('index', 0)
        nextPicture.src = getImage('Any%', 0)
        nextPicture.style.display = null

        preloadPicture.src = getImage('Any%', 1)

        downloadSplits.onclick = function() {
          window.open('https://github.com/jbzdarkid/WitnessGuide/raw/main/' + window.guides[guideChooser.value] + '/_splits.lss')
        }

        // Function that runs when you change guides
        guideChooser.onchange = function() {
          nextPicture.setAttribute('index', 0)
          nextPicture.src = getImage(guideChooser.value, 0)
          preloadPicture.src = getImage(guideChooser.value, 1)
        }

        // Function that runs when you click on the image
        nextPicture.onclick = function(event) {
          if (nextPicture.style.opacity == 0.5) return // Already loading an image

          var isRightClick = event.which === 3 || !!(event.touches && event.touches.length > 1)
          var index = parseInt(nextPicture.getAttribute('index'))
          index = index + (isRightClick ? -1 : 1)
          if (index < 0) index = 0
          nextPicture.setAttribute('index', index)
          nextPicture.src = getImage(guideChooser.value, index)
          nextPicture.style.opacity = 0.5

          preloadPicture.src = getImage(guideChooser.value, index + 1)
        }
        nextPicture.oncontextmenu = function(event) {
          event.preventDefault()
        }
        nextPicture.onload = function() {
          nextPicture.style.opacity = 1.0
        }
      }
    </script>
  </head>
  <body>
    <div style="display: flex; flex-direction: column; height: 100%">
      <div style="display: flex; flex-direction: row; align-items: center; justify-content: space-evenly">
        <select id="guideChooser" style="font-size: 64px"></select>
        <button id="downloadSplits" style="font-size: 64px">Download Splits</button>
      </div>
      <img id="nextPicture" style="display:none; object-fit: contain" />
    </div>
  </body>
</html>
